<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcast Generator</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 2rem; }
        .input-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.25rem; }
        input, textarea, select { width: 100%; padding: 0.5rem; font-size: 1rem; border-radius: 4px; border: 1px solid #ccc; }
        textarea { min-height: 100px; }
        button { width: 100%; padding: 0.75rem; font-size: 1.1rem; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        #status { margin-top: 1rem; padding: 1rem; background-color: #f0f0f0; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Podcast Generator</h1>
    <div class="input-group">
        <label for="topic">Topic</label>
        <input type="text" id="topic" placeholder="e.g., The History of Coffee">
    </div>
    <div class="input-group">
        <label for="context">Context / Main Points</label>
        <textarea id="context" placeholder="e.g., Mention its discovery in Ethiopia, its spread to Europe, and modern cafe culture."></textarea>
    </div>
    <div class="input-group">
        <label for="duration">Duration</label>
        <select id="duration">
            <option value="2 minutes">2 Minutes</option>
            <option value="5 minutes" selected>5 Minutes</option>
            <option value="10 minutes">10 Minutes</option>
        </select>
    </div>
    <button onclick="submitJob()">Generate Podcast</button>
    <div id="status">Your job status will appear here.</div>

    <script>
        const RENDER_API_URL = "https://mosaicdgitial-sonify-ws.onrender.com";

        function submitJob() {
            const topic = document.getElementById('topic').value;
            const context = document.getElementById('context').value;
            const duration = document.getElementById('duration').value;
            const statusDiv = document.getElementById('status');

            if (!topic || !context) {
                statusDiv.textContent = 'Please fill out both topic and context fields.';
                return;
            }

            statusDiv.textContent = 'Submitting job...';

            fetch(`${RENDER_API_URL}/generate-from-idea`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ topic, context, duration })
            })
            .then(response => response.json())
            .then(data => {
                if (data.job_id) {
                    statusDiv.textContent = `Job queued! Job ID: ${data.job_id}. Checking status...`;
                    pollForStatus(data.job_id);
                } else {
                    statusDiv.textContent = 'Error submitting job: ' + (data.error || 'Unknown error');
                }
            })
            .catch(err => {
                console.error('Error submitting job:', err);
                statusDiv.textContent = 'Error submitting job: ' + err.message;
            });
        }

        function pollForStatus(jobId) {
            const interval = setInterval(() => {
                fetch(`${RENDER_API_URL}/podcast-status/${jobId}`)
                    .then(response => response.json())
                    .then(data => {
                        const statusDiv = document.getElementById('status');
                        statusDiv.textContent = `Job ${jobId}: ${data.status}`;

                        if (data.status === 'complete') {
                            clearInterval(interval);
                            statusDiv.innerHTML = `Job Complete! <br><br> <audio controls src="${data.podcast_url}"></audio>`;
                        } else if (data.status === 'failed') {
                            clearInterval(interval);
                            statusDiv.textContent = `Job failed: ${data.error_message}`;
                        }
                    })
                    .catch(err => {
                        clearInterval(interval);
                        console.error('Error polling status:', err);
                        document.getElementById('status').textContent = 'Error checking status.';
                    });
            }, 5000);
        }
    </script>
</body>
</html>